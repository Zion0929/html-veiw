# AI程序生成器

## 项目概述
AI程序生成器是一款基于手机端的应用程序，允许用户通过自然语言描述需求，由AI自动生成对应的HTML程序并运行。本应用使用HBuilderX打包为安卓软件，后端部署在Vercel上，调用派欧云提供的deepseek模型来生成代码。

## 技术架构
1. **前端**：移动优化的HTML/CSS/JavaScript界面，适配手机屏幕和操作方式
2. **后端**：基于Vercel的Serverless函数，处理API请求并与派欧云API通信
3. **AI模型**：调用派欧云提供的deepseek-v3-0324模型，通过OpenAI兼容接口生成代码
4. **打包工具**：使用HBuilderX将Web应用打包为安卓应用程序

## 部署说明
项目提供了详细的部署指南，请参考[部署指南](DEPLOYMENT.md)文档了解如何将前端和后端部署到Vercel。

### 配置步骤总结

#### 1. 后端部署到Vercel

1. 注册或登录Vercel账号: https://vercel.com/signup 
2. 安装Vercel CLI:
   ```bash
   npm install -g vercel
   ```
3. 部署后端服务:
   ```bash
   # 进入后端目录
   cd vercel-backend
   
   # 登录Vercel
   vercel login
   
   # 部署服务
   vercel
   
   # 部署到生产环境
   vercel --prod
   ```
4. 获取生成的Vercel后端URL (例如: https://your-app-name.vercel.app)

#### 2. 前端配置

1. 更新前端配置指向后端:
   - 打开 `js/config.js` 文件
   - 修改 `API_ENDPOINT` 为 Vercel 后端URL，确保包含 `/api/generate` 路径:
     ```javascript
     API_ENDPOINT: 'https://your-app-name.vercel.app/api/generate',
     ```

#### 3. HBuilderX打包为安卓应用

1. 安装 [HBuilderX](https://www.dcloud.io/hbuilderx.html)
2. 在HBuilderX中打开项目文件夹
3. 检查 manifest.json 配置，确保:
   - 包名设置正确
   - 网络权限已配置
   - 应用图标和启动页设置
4. 云打包步骤:
   - 点击菜单: 发行 > 原生App-云打包
   - 选择"安卓"
   - 配置证书信息(若无证书可选择"使用公共测试证书")
   - 点击"打包"按钮
   - 等待云端打包完成后下载APK文件

## 配置说明
项目现在支持通过配置文件设置API端点。配置包括：

1. **API端点配置**：
   - 应用会自动检测环境（本地/生产），并使用相应的API端点
   - 用户可以通过设置界面修改Vercel API端点
   - 配置会保存在本地存储中，无需每次设置

2. **使用设置界面**：
   - 点击右上角的⚙️图标打开设置界面
   - 输入Vercel后端API端点URL（必须包含 /api/generate 路径）
   - 点击"保存"保存设置

3. **环境检测**：
   - 本地开发环境（localhost或file://协议）会使用本地API端点
   - 生产环境使用配置的Vercel API端点
   - 离线状态会使用备用示例代码

## 项目结构
项目已重构为模块化结构，便于维护和扩展：

```
ai-code-generator/
├── index.html             # 主HTML文件
├── css/
│   ├── style.css          # 主样式（基础样式、布局）
│   ├── components.css     # 组件样式（卡片、按钮、表单等）
│   └── animations.css     # 动画效果样式
├── js/
│   ├── app.js             # 应用入口（初始化和全局设置）
│   ├── api.js             # API请求和代码生成
│   ├── ui.js              # UI交互和组件管理
│   ├── config.js          # 应用配置
│   └── storage.js         # 本地存储和应用管理
└── vercel-backend/        # 后端代码（Vercel部署）
    ├── api/               # Vercel API函数
    │   └── generate.js    # 代码生成API
    ├── vercel.json        # Vercel配置
    ├── package.json       # 后端依赖
    └── .env               # 环境变量配置
```

## 功能说明
1. **代码生成**：用户输入需求描述，AI自动生成相应的HTML代码
2. **代码预览**：生成代码后自动进入预览界面
3. **代码编辑**：允许用户在生成后修改代码
4. **保存功能**：将生成的HTML代码保存到本地
5. **运行功能**：直接在应用内运行生成的代码
6. **历史记录**：保存用户的生成历史，方便重复使用

## 最新界面优化
项目已进行了移动端界面优化，主要包括以下改进：

1. **代码生成过程优化**：
   - 将全屏代码生成修改为框内流式显示代码
   - 优化代码高亮显示效果
   - 提供更直观的生成进度和状态显示

2. **预览界面改进**：
   - 在预览界面底部添加保存按钮，便于直接保存
   - 优化预览界面布局
   - 根据来源控制保存按钮显示（仅AI生成界面进入的预览显示保存按钮）

3. **应用列表优化**：
   - 默认按最近使用时间排序
   - 移除了排序选项，简化界面
   - 应用内直接预览运行，不显示保存选项

4. **图标选择器优化**：
   - 修复了图标选择功能问题
   - 改进选择图标的用户体验

## 使用方法
1. 打开应用
2. 在输入区域描述您想要的程序功能
3. 点击"生成"按钮，等待AI生成代码（可在框内实时查看代码生成）
4. 应用会自动显示生成代码的预览效果
5. 可在预览界面底部直接保存生成的应用程序

## 调试说明
项目进行了模块化重构，文件结构更加清晰，方便维护和扩展。如果需要调试：

1. **前端调试**：
   - 直接在浏览器中打开`index.html`
   - 在开发者工具中查看控制台输出
   - 支持移动设备响应式预览

2. **后端调试**：
   - 进入`vercel-backend`目录
   - 按照Vercel开发指南进行本地开发和调试

## 常见问题排查

### 应用初始化失败
- **API端点配置错误**：确保CONFIG.API_ENDPOINT包含完整的API路径（例如：https://your-app.vercel.app/api/generate）
- **环境变量问题**：确保Vercel后端正确设置了PIAO_API_KEY环境变量
- **控制台错误**：打开浏览器控制台查看具体的错误信息
- **解决方法**：点击错误消息中的"打开设置"按钮，设置正确的API端点

### 代码生成失败
- 确认Vercel后端服务是否正常运行
- 检查API请求是否正确发送（在控制台查看网络请求）
- 当API不可用时，应用会使用备用样例代码
- 确保PIAO_API_KEY配置正确且有效

### 图标选择器问题
- 已优化图标选择器的实现方式，改用data-icon属性和事件委托
- 如遇问题请检查控制台错误信息

### 长按功能无效
- 长按功能主要为移动设备设计
- 在桌面浏览器中，可能需要点击并保持几秒钟

### 部署问题排查
1. **后端部署问题**：
   - 确保创建了.env文件，并正确设置了PIAO_API_KEY
   - 检查Vercel部署日志是否有错误
   - 确认API端点能够正确响应请求（可通过Postman或浏览器测试）

2. **前端配置问题**：
   - 确保js/config.js中的API_ENDPOINT指向正确的后端地址
   - API端点必须包含完整路径，例如：https://your-app.vercel.app/api/generate

3. **API密钥问题**：
   - 确保派欧云API密钥(PIAO_API_KEY)有效且余额充足
   - 后端.env文件中的API密钥与Vercel环境变量中设置的一致

4. **安卓打包问题**：
   - 检查manifest.json中的权限配置，确保包含INTERNET权限
   - 验证打包过程中证书配置正确
   - 确保应用包名符合规范

## API文档
### 代码生成API
- **端点**: `/api/generate`
- **方法**: POST
- **请求体**:
  ```json
  {
    "prompt": "用户输入的需求描述",
    "model": "deepseek"
  }
  ```
- **响应**:
  ```json
  {
    "code": "生成的HTML代码"
  }
  ```

## 未来计划
1. 支持更多编程语言和框架
2. 添加AI辅助代码解释和教学功能
3. 提供代码片段库，加速开发过程
4. 引入云同步功能，跨设备访问项目
5. 优化生成代码的性能和兼容性
6. 进一步改进移动端用户体验

## 项目重构说明
原始项目代码是一个单一的HTML文件（zimini.html），包含了所有的HTML结构、CSS样式和JavaScript代码。项目重构将其分解为多个模块化文件，主要变更包括：

1. **分离关注点**：
   - HTML结构、CSS样式和JavaScript逻辑分离
   - CSS按功能分为基础样式、组件样式和动画效果
   - JavaScript按功能分为应用入口、API功能、UI交互和存储管理

2. **优化代码组织**：
   - 功能相关的代码组织在一起
   - 减少代码重复和冗余
   - 提高可维护性和可扩展性

3. **调试与测试**：
   - 便于单独开发和测试各个模块
   - 错误处理和日志功能优化

4. **移动端优化**：
   - 适配安卓应用场景
   - 优化屏幕空间利用
   - 简化操作流程
   - 改进用户体验流程

## 最新更新内容

1. **添加配置系统**：
   - 新增`js/config.js`文件，用于管理全局配置
   - 实现API端点配置，支持自动识别本地/生产环境
   - 添加用户自定义API端点设置界面

2. **优化API调用**：
   - 重构`generateCode`函数，提高代码质量和可维护性
   - 添加更详细的错误处理和进度反馈
   - 支持离线模式，当API不可用时使用备用代码

3. **添加部署指南**：
   - 创建`DEPLOYMENT.md`文件，详细说明部署步骤
   - 包含前端和后端部署到Vercel的完整指南
   - 提供故障排查和环境配置指南

4. **界面优化**：
   - 添加设置模态窗口，便于用户配置API端点
   - 优化代码生成状态显示
   - 改进错误消息的展示方式

5. **后端配置优化**：
   - 增强`.env.example`配置示例，提供更多说明
   - 统一Vercel部署配置
   - 简化API调用流程

### 2024-03-31
1. **修复API端点配置问题**：
   - 更新config.js中的API_ENDPOINT，确保包含完整路径(/api/generate)
   - 增强validateApiConfig()函数，检查API端点格式
   - 改进错误处理和用户提示

2. **优化错误显示**：
   - 增强showErrorMessage()函数，提供更详细的错误信息
   - 添加"打开设置"按钮，方便直接修改配置
   - 为错误消息添加关闭按钮，改善用户体验

3. **完成Vercel部署与HBuilderX打包配置**：
   - 更新vercel.json，增加CORS支持
   - 完善manifest.json权限配置
   - 增加HBuilderX打包为安卓应用的详细说明
